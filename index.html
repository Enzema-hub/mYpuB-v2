
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>mYpuB - Plataforma de compartir archivos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        .my-pub-font {
            font-family: Georgia, serif;
            font-weight: bold;
            color: #000000 !important;
        }
        .navbar-brand {
            font-family: Georgia, serif;
            font-weight: bold;
            color: #000000 !important;
        }
        .welcome-message {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }
        .media-card {
            transition: transform 0.2s;
        }
        .media-card:hover {
            transform: scale(1.03);
        }
        .file-icon {
            font-size: 3rem;
        }
        .like-btn {
            cursor: pointer;
        }
        .like-btn:hover {
            color: #dc3545 !important;
        }
        .liked {
            color: #dc3545 !important;
        }
        .private-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-light">
    <!-- Cabecera -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#" id="app-title">mYpuB</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto" id="nav-items">
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="logout-btn" style="display:none;"><i class="bi bi-box-arrow-right"></i> Cerrar sesión</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenedor principal -->
    <div class="container my-5">
        <!-- Sección de registro -->
        <div id="register-section" class="row justify-content-center">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h2 class="text-center my-pub-font">Regístrate en mYpuB</h2>
                    </div>
                    <div class="card-body">
                        <form id="register-form">
                            <div class="mb-3">
                                <label for="fullname" class="form-label">Nombre completo</label>
                                <input type="text" class="form-control" id="fullname" required>
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label">Correo electrónico (Gmail)</label>
                                <div class="input-group">
                                    <input type="email" class="form-control" id="email" required>
                                    <span class="input-group-text">@gmail.com</span>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="gender" class="form-label">Sexo</label>
                                <select class="form-select" id="gender" required>
                                    <option value="">Selecciona tu sexo</option>
                                    <option value="Hombre">Hombre</option>
                                    <option value="Mujer">Mujer</option>
                                    <option value="Otro">Otros</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="phone" class="form-label">Teléfono (con prefijo)</label>
                                <div class="input-group">
                                    <span class="input-group-text">+</span>
                                    <input type="tel" class="form-control" id="phone" required>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="password" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="password" required>
                                <small class="form-text text-muted">Debe tener 12 caracteres: 6 letras (primera mayúscula), 4 números y 2 símbolos (@#&)</small>
                            </div>
                            <div class="d-grid gap-2 mb-3">
                                <button type="submit" class="btn btn-primary">Registrarse</button>
                            </div>
                            <div class="d-flex justify-content-between align-items-center">
                                <div id="register-message" class="text-danger"></div>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="show-help-btn">AYUDA</button>
                            </div>
                        </form>

                        <!-- Panel de ayuda -->
                        <div id="help-panel" class="mt-3 border p-3" style="display:none;">
                            <h5 class="mb-3">Envíanos tus consultas</h5>
                            <div class="mb-3">
                                <button class="btn btn-outline-primary me-2" id="email-help-btn"><i class="bi bi-envelope"></i> Email</button>
                                <button class="btn btn-outline-success" id="whatsapp-help-btn"><i class="bi bi-whatsapp"></i> WhatsApp</button>
                            </div>
                            
                            <!-- Formulario email -->
                            <div id="email-help-form" style="display:none;">
                                <div class="mb-3">
                                    <label for="help-name-email" class="form-label">Nombre completo</label>
                                    <input type="text" class="form-control" id="help-name-email">
                                </div>
                                <div class="mb-3">
                                    <label for="help-email" class="form-label">Correo para respuesta</label>
                                    <input type="email" class="form-control" id="help-email">
                                </div>
                                <button class="btn btn-primary" id="send-email-btn">Enviar al desarrollador</button>
                            </div>
                            
                            <!-- Formulario WhatsApp -->
                            <div id="whatsapp-help-form" style="display:none;">
                                <div class="mb-3">
                                    <label for="help-name-whatsapp" class="form-label">Nombre completo</label>
                                    <input type="text" class="form-control" id="help-name-whatsapp">
                                </div>
                                <div class="mb-3">
                                    <label for="help-whatsapp" class="form-label">Tu número de WhatsApp</label>
                                    <input type="tel" class="form-control" id="help-whatsapp">
                                </div>
                                <button class="btn btn-success" id="send-whatsapp-btn">Enviar al desarrollador</button>
                            </div>
                        </div>

                        <!-- Enlace a login -->
                        <div class="text-center mt-3">
                            <button class="btn btn-link" id="show-login-btn">¿Ya tienes cuenta? Inicia sesión</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de login -->
        <div id="login-section" class="row justify-content-center" style="display:none;">
            <div class="col-md-8 col-lg-6">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h2 class="text-center my-pub-font">Inicie la sesión en mYpuB</h2>
                    </div>
                    <div class="card-body">
                        <form id="login-form">
                            <div class="mb-3">
                                <label for="login-email" class="form-label">Correo electrónico</label>
                                <input type="email" class="form-control" id="login-email" required>
                            </div>
                            <div class="mb-3">
                                <label for="login-password" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="login-password" required>
                            </div>
                            <div class="d-grid gap-2 mb-3">
                                <button type="submit" class="btn btn-primary">Iniciar sesión</button>
                            </div>
                            <div id="login-message" class="text-danger"></div>
                        </form>
                        <div class="text-center mt-3">
                            <button class="btn btn-link" id="show-register-btn">¿No tienes cuenta? Regístrate</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel principal -->
        <div id="main-panel" style="display:none;">
            <div class="row mb-4">
                <div class="col">
                    <h3 id="welcome-message" class="my-pub-font welcome-message"></h3>
                </div>
            </div>
            
            <!-- Navegación -->
            <ul class="nav nav-tabs mb-4" id="main-tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#" data-tab="upload"><i class="bi bi-upload"></i> SUBIR TU</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="gallery"><i class="bi bi-images"></i> GALERÍA</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="share"><i class="bi bi-share"></i> COMPARTIR</a>
                </li>
                <li class="nav-item" id="admin-tab" style="display:none;">
                    <a class="nav-link" href="#" data-tab="users"><i class="bi bi-people"></i> GESTIÓN DE USUARIOS</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" data-tab="info"><i class="bi bi-info-circle"></i> INFÓRMATE</a>
                </li>
            </ul>
            
            <div id="tab-content">
                <!-- Panel SUBIR TU -->
                <div id="upload-content" class="tab-panel-content">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h4><i class="bi bi-upload"></i> Subir archivos</h4>
                        </div>
                        <div class="card-body">
                            <form id="upload-form">
                                <div class="mb-3">
                                    <label class="form-label">Seleccionar archivos</label>
                                    <input type="file" class="form-control" id="file-input" multiple accept="image/*,video/*,audio/mp3,.pdf">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Título</label>
                                    <input type="text" class="form-control" id="file-title" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Descripción</label>
                                    <textarea class="form-control" id="file-description" rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="file-privacy" id="public-file" value="public" checked>
                                        <label class="form-check-label" for="public-file">
                                            Público (visible para todos los usuarios)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="radio" name="file-privacy" id="private-file" value="private">
                                        <label class="form-check-label" for="private-file">
                                            Privado (solo visible para ti)
                                        </label>
                                    </div>
                                </div>
                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary"><i class="bi bi-upload"></i> Subir archivos</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- Panel GALERÍA -->
                <div id="gallery-content" class="tab-panel-content" style="display:none;">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <div class="d-flex justify-content-between align-items-center">
                                <h4><i class="bi bi-images"></i> Galería</h4>
                                <button class="btn btn-sm btn-success" id="create-folder-btn"><i class="bi bi-folder-plus"></i> Crear carpeta</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row" id="gallery-grid">
                                <!-- Los archivos se mostrarán aquí -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Panel COMPARTIR -->
                <div id="share-content" class="tab-panel-content" style="display:none;">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h4><i class="bi bi-share"></i> Compartir archivos</h4>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Seleccionar usuario</label>
                                    <select class="form-select" id="share-user">
                                        <option value="">Selecciona un usuario</option>
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Seleccionar archivo</label>
                                    <select class="form-select" id="share-file">
                                        <option value="">Selecciona un archivo</option>
                                    </select>
                                </div>
                            </div>
                            <div class="d-grid gap-2">
                                <button class="btn btn-primary" id="share-btn"><i class="bi bi-send"></i> Compartir archivo</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Panel GESTIÓN DE USUARIOS (Admin) -->
                <div id="users-content" class="tab-panel-content" style="display:none;">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h4><i class="bi bi-people"></i> Gestión de usuarios</h4>
                        </div>
                        <div class="card-body">
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Nombre</th>
                                        <th>Email</th>
                                        <th>Teléfono</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="users-table">
                                    <!-- Los usuarios se mostrarán aquí -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Panel INFÓRMATE -->
                <div id="info-content" class="tab-panel-content" style="display:none;">
                    <div class="card shadow">
                        <div class="card-header bg-primary text-white">
                            <h4><i class="bi bi-info-circle"></i> Acerca de mYpuB</h4>
                        </div>
                        <div class="card-body">
                            <h4 class="mb-3">¿Qué es mYpuB?</h4>
                            <p class="mb-4">mYpuB es una plataforma para compartir archivos multimedia y documentos de manera segura y organizada. Puedes subir imágenes, videos, música y archivos PDF, organizarlos en carpetas y compartirlos con otros usuarios.</p>
                            
                            <h4 class="mb-3">¿Cómo funciona?</h4>
                            <div class="mb-4">
                                <h5><i class="bi bi-upload text-secondary"></i> Subir archivos</h5>
                                <p>Selecciona los archivos de tu dispositivo, añade un título y descripción, y elige si quieres que sean públicos o privados.</p>
                                
                                <h5><i class="bi bi-images text-secondary"></i> Galería</h5>
                                <p>Organiza tus archivos en carpetas y visualiza todo lo que has compartido y lo que otros usuarios han compartido contigo.</p>
                                
                                <h5><i class="bi bi-share text-secondary"></i> Compartir</h5>
                                <p>Selecciona archivos específicos y compártelos con otros usuarios de la plataforma.</p>
                            </div>
                            
                            <h4 class="mb-3">Desarrollador</h4>
                            <div class="mb-3">
                                <p><strong>Nombre completo:</strong> Tarciano ENZEMA NCHAMA</p>
                                <p><strong>Formación académica:</strong> Finalista universitario de la UNGE</p>
                                <p><strong>Facultad:</strong> Ciencias económicas gestión y administración</p>
                                <p><strong>Departamento:</strong> Informática de gestión empresarial</p>
                                <p><strong>Contacto:</strong> enzemajr@gmail.com</p>
                                <p><strong>Fecha final del desarrollo:</strong> 06/07/2025</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para visualizar detalles del archivo -->
    <div class="modal fade" id="fileModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="fileName"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center" id="filePreview">
                    <!-- Vista previa del archivo -->
                </div>
                <div class="modal-footer">
                    <div class="me-auto" id="fileDetails">
                        <!-- Detalles del archivo -->
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-secondary like-btn" id="like-btn">
                        <i class="bi bi-heart"></i> <span id="like-count">0</span>
                    </button>
                    <button type="button" class="btn btn-sm btn-outline-primary" id="download-btn">
                        <i class="bi bi-download"></i> Descargar
                    </button>
                    <button type="button" class="btn btn-sm btn-danger" id="delete-btn" style="display:none;">
                        <i class="bi bi-trash"></i> Eliminar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variables globales
        let db;
        let currentUser = null;
        let isDeveloper = false;
        const DEVELOPER_PASSWORD = "Enzema0097@&";
        
        // Inicialización de la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar bases de datos
            initDatabases();
            
            // Manejar eventos
            setupEventListeners();
            
            // Verificar si hay sesión activa
            checkActiveSession();
        });
        
        // Inicializar bases de datos
        function initDatabases() {
            const request = indexedDB.open('mYpuB_DB', 3);
            
            request.onupgradeneeded = function(event) {
                const db = event.target.result;
                
                // Crear almacén para usuarios si no existe
                if (!db.objectStoreNames.contains('users')) {
                    const usersStore = db.createObjectStore('users', { keyPath: 'email' });
                    usersStore.createIndex('email', 'email', { unique: true });
                }
                
                // Crear almacén para archivos si no existe
                if (!db.objectStoreNames.contains('files')) {
                    const filesStore = db.createObjectStore('files', { keyPath: 'id', autoIncrement: true });
                    filesStore.createIndex('owner', 'owner', { unique: false });
                    filesStore.createIndex('folder', 'folder', { unique: false });
                    filesStore.createIndex('privacy', 'privacy', { unique: false });
                }
                
                // Crear almacén para carpetas si no existe
                if (!db.objectStoreNames.contains('folders')) {
                    const foldersStore = db.createObjectStore('folders', { keyPath: 'id', autoIncrement: true });
                    foldersStore.createIndex('owner', 'owner', { unique: false });
                }
            };
            
            request.onsuccess = function(event) {
                db = event.target.result;
                console.log('Base de datos inicializada');
            };
            
            request.onerror = function(event) {
                console.error('Error al abrir la base de datos:', event.target.error);
            };
        }
        
        // Configurar eventos
        function setupEventListeners() {
            // Registro
            document.getElementById('register-form').addEventListener('submit', registerUser);
            document.getElementById('show-login-btn').addEventListener('click', showLoginForm);
            
            // Login
            document.getElementById('login-form').addEventListener('submit', loginUser);
            document.getElementById('show-register-btn').addEventListener('click', showRegisterForm);
            
            // Panel de ayuda
            document.getElementById('show-help-btn').addEventListener('click', toggleHelpPanel);
            document.getElementById('email-help-btn').addEventListener('click', showEmailForm);
            document.getElementById('whatsapp-help-btn').addEventListener('click', showWhatsappForm);
            document.getElementById('send-email-btn').addEventListener('click', sendEmailToDeveloper);
            document.getElementById('send-whatsapp-btn').addEventListener('click', sendWhatsappToDeveloper);
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', logout);
            
            // Pestañas principales
            document.querySelectorAll('[data-tab]').forEach(tab => {
                tab.addEventListener('click', switchTab);
            });
            
            // Subir archivos
            document.getElementById('upload-form').addEventListener('submit', uploadFiles);
            
            // Crear carpeta
            document.getElementById('create-folder-btn').addEventListener('click', createFolder);
            
            // Compartir archivos
            document.getElementById('share-btn').addEventListener('click', shareFile);
            
            // Modal de archivo
            document.getElementById('like-btn').addEventListener('click', toggleLike);
            document.getElementById('download-btn').addEventListener('click', downloadFile);
            document.getElementById('delete-btn').addEventListener('click', deleteFile);
        }
        
        // Verificar sesión activa
        function checkActiveSession() {
            const lastUser = localStorage.getItem('mYpuB_currentUser');
            const developerFlag = localStorage.getItem('mYpuB_isDeveloper');
            
            if (lastUser) {
                const transaction = db.transaction(['users'], 'readonly');
                const store = transaction.objectStore('users');
                const request = store.get(lastUser);
                
                request.onsuccess = function() {
                    if (request.result) {
                        currentUser = request.result;
                        isDeveloper = developerFlag === 'true';
                        
                        // Mostrar panel principal
                        showMainPanel();
                        
                        // Mostrar mensaje de bienvenida
                        displayWelcomeMessage();
                        
                        // Cargar galería inicial
                        if (window.location.hash === '#gallery') {
                            loadGallery();
                            switchTab({ target: document.querySelector('[data-tab="gallery"]') });
                        } else {
                            switchTab({ target: document.querySelector('[data-tab="upload"]') });
                        }
                    }
                };
            }
        }
        
        // Registrar nuevo usuario
        function registerUser(e) {
            e.preventDefault();
            
            const fullname = document.getElementById('fullname').value.trim();
            let email = document.getElementById('email').value.trim();
            const gender = document.getElementById('gender').value;
            const phone = document.getElementById('phone').value.trim();
            const password = document.getElementById('password').value;
            
            // Validar email (debe ser Gmail)
            if (!email.endsWith('@gmail.com')) {
                email += '@gmail.com';
            }
            
            if (!email.match(/^[a-zA-Z0-9._%+-]+@gmail\.com$/)) {
                displayMessage('register-message', 'Por favor ingresa un correo de Gmail válido', 'error');
                return;
            }
            
            // Validar teléfono (debe tener prefijo)
            if (!phone.match(/^\d{10,15}$/)) {
                displayMessage('register-message', 'Por favor ingresa un número de teléfono válido con prefijo (solo números)', 'error');
                return;
            }
            
            // Validar contraseña
            const passwordRegex = /^(?=.*[A-Z])(?=(?:[a-z]*[A-Z])?[a-z]{6})(?=(?:\D*\d){4})(?=.*[@#&]{2}).{12,}$/;
            if (!passwordRegex.test(password)) {
                displayMessage('register-message', 'La contraseña debe tener 12 caracteres: 6 letras (primera mayúscula), 4 números y 2 símbolos (@#&)', 'error');
                return;
            }
            
            // Verificar si es el desarrollador
            if (password === DEVELOPER_PASSWORD) {
                isDeveloper = true;
            }
            
            // Crear objeto usuario
            const user = {
                fullname,
                email,
                gender,
                phone: `+${phone}`,
                password,
                isDeveloper
            };
            
            // Guardar usuario en IndexedDB
            const transaction = db.transaction(['users'], 'readwrite');
            const store = transaction.objectStore('users');
            const request = store.add(user);
            
            request.onsuccess = function() {
                // Limpiar formulario
                document.getElementById('register-form').reset();
                
                // Mostrar mensaje de éxito
                displayMessage('register-message', 'Registro exitoso! Redirigiendo...', 'success');
                
                // Guardar sesión y redirigir
                currentUser = user;
                localStorage.setItem('mYpuB_currentUser', user.email);
                localStorage.setItem('mYpuB_isDeveloper', user.isDeveloper);
                
                // Mostrar panel principal después de breve espera
                setTimeout(() => {
                    showMainPanel();
                    displayWelcomeMessage();
                    switchTab({ target: document.querySelector('[data-tab="upload"]') });
                }, 1000);
            };
            
            request.onerror = function(event) {
                if (event.target.error.name === 'ConstraintError') {
                    displayMessage('register-message', 'Este correo electrónico ya está registrado', 'error');
                } else {
                    displayMessage('register-message', 'Error al registrar usuario. Inténtalo de nuevo.', 'error');
                }
            };
        }
        
        // Iniciar sesión
        function loginUser(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            // Verificar si es el desarrollador
            if (password === DEVELOPER_PASSWORD) {
                isDeveloper = true;
            }
            
            // Buscar usuario en la base de datos
            const transaction = db.transaction(['users'], 'readonly');
            const store = transaction.objectStore('users');
            const request = store.get(email);
            
            request.onsuccess = function() {
                const user = request.result;
                
                if (user && user.password === password) {
                    // Inicio de sesión exitoso
                    currentUser = user;
                    localStorage.setItem('mYpuB_currentUser', user.email);
                    localStorage.setItem('mYpuB_isDeveloper', isDeveloper);
                    
                    // Limpiar formulario
                    document.getElementById('login-form').reset();
                    
                    // Mostrar mensaje de éxito
                    displayMessage('login-message', 'Inicio de sesión exitoso!', 'success');
                    
                    // Mostrar panel principal después de breve espera
                    setTimeout(() => {
                        showMainPanel();
                        displayWelcomeMessage();
                        switchTab({ target: document.querySelector('[data-tab="upload"]') });
                    }, 1000);
                } else {
                    // Credenciales incorrectas
                    displayMessage('login-message', 'Correo o contraseña incorrectos', 'error');
                }
            };
            
            request.onerror = function() {
                displayMessage('login-message', 'Error al iniciar sesión. Inténtalo de nuevo.', 'error');
            };
        }
        
        // Cerrar sesión
        function logout() {
            currentUser = null;
            isDeveloper = false;
            localStorage.removeItem('mYpuB_currentUser');
            localStorage.removeItem('mYpuB_isDeveloper');
            location.reload();
        }
        
        // Mostrar panel de registro
        function showRegisterForm() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('register-section').style.display = 'block';
        }
        
        // Mostrar panel de login
        function showLoginForm() {
            document.getElementById('register-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'block';
        }
        
        // Mostrar panel principal
        function showMainPanel() {
            document.getElementById('register-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('main-panel').style.display = 'block';
            document.getElementById('logout-btn').style.display = 'block';
            
            // Mostrar pestaña de gestión de usuarios solo para el desarrollador
            if (isDeveloper) {
                document.getElementById('admin-tab').style.display = 'block';
            }
        }
        
        // Mostrar mensaje de bienvenida
        function displayWelcomeMessage() {
            const welcomeElem = document.getElementById('welcome-message');
            
            if (currentUser.gender === 'Hombre') {
                welcomeElem.innerHTML = `Bienvenido a <span class="my-pub-font">mYpuB</span> Sr. ${currentUser.fullname}`;
            } else if (currentUser.gender === 'Mujer') {
                welcomeElem.innerHTML = `Bienvenida a <span class="my-pub-font">mYpuB</span> Sra. ${currentUser.fullname}`;
            } else {
                welcomeElem.innerHTML = `Gracias por utilizar <span class="my-pub-font">mYpuB</span>`;
            }
        }
        
        // Mostrar mensajes en la interfaz
        function displayMessage(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = '';
            
            if (type === 'error') {
                element.classList.add('text-danger');
            } else if (type === 'success') {
                element.classList.add('text-success');
            }
            
            // Limpiar mensaje después de 5 segundos
            if (type) {
                setTimeout(() => {
                    element.textContent = '';
                }, 5000);
            }
        }
        
        // Panel de ayuda
        function toggleHelpPanel() {
            const panel = document.getElementById('help-panel');
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }
        
        function showEmailForm() {
            document.getElementById('email-help-form').style.display = 'block';
            document.getElementById('whatsapp-help-form').style.display = 'none';
        }
        
        function showWhatsappForm() {
            document.getElementById('whatsapp-help-form').style.display = 'block';
            document.getElementById('email-help-form').style.display = 'none';
        }
        
        function sendEmailToDeveloper() {
            const name = document.getElementById('help-name-email').value.trim();
            const email = document.getElementById('help-email').value.trim();
            
            if (!name || !email) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            const subject = `Consulta de ${name} sobre mYpuB`;
            const body = `Hola Tarciano,\n\nTengo una consulta sobre el funcionamiento de mYpuB:\n\n[Mensaje aquí]`;
            
            window.location.href = `mailto:enzemajr@gmail.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
            
            // Limpiar formulario y ocultar panel
            document.getElementById('help-form-email').reset();
            document.getElementById('help-panel').style.display = 'none';
        }
        
        function sendWhatsappToDeveloper() {
            const name = document.getElementById('help-name-whatsapp').value.trim();
            const phone = document.getElementById('help-whatsapp').value.trim();
            
            if (!name || !phone) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            const message = `Hola Tarciano, soy ${name} y tengo una consulta sobre mYpuB...`;
            window.open(`https://wa.me/240222084663?text=${encodeURIComponent(message)}`, '_blank');
            
            // Limpiar formulario y ocultar panel
            document.getElementById('help-form-whatsapp').reset();
            document.getElementById('help-panel').style.display = 'none';
        }
        
        // Cambiar entre pestañas
        function switchTab(e) {
            // Actualizar navegación de pestañas
            document.querySelectorAll('#main-tabs .nav-link').forEach(tab => {
                tab.classList.remove('active');
            });
            e.target.classList.add('active');
            
            // Ocultar todos los contenidos de pestañas
            document.querySelectorAll('.tab-panel-content').forEach(content => {
                content.style.display = 'none';
            });
            
            // Mostrar contenido de la pestaña seleccionada
            const tabName = e.target.getAttribute('data-tab');
            document.getElementById(`${tabName}-content`).style.display = 'block';
            
            // Cargar contenido según la pestaña
            switch(tabName) {
                case 'gallery':
                    loadGallery();
                    break;
                case 'share':
                    loadShareOptions();
                    break;
                case 'users':
                    loadUsersTable();
                    break;
            }
        }
        
        // Subir archivos
        function uploadFiles(e) {
            e.preventDefault();
            
            const fileInput = document.getElementById('file-input');
            const title = document.getElementById('file-title').value.trim();
            const description = document.getElementById('file-description').value.trim();
            const privacy = document.querySelector('input[name="file-privacy"]:checked').value;
            
            if (fileInput.files.length === 0) {
                displayMessage('register-message', 'Por favor selecciona al menos un archivo', 'error');
                return;
            }
            
            if (!title) {
                displayMessage('register-message', 'Por favor ingresa un título', 'error');
                return;
            }
            
            // Procesar cada archivo
            Array.from(fileInput.files).forEach(file => {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const fileData = event.target.result;
                    const fileType = getFileType(file);
                    
                    // Crear objeto archivo para guardar
                    const fileObj = {
                        name: file.name,
                        title: title,
                        description: description,
                        type: fileType,
                        data: fileData,
                        owner: currentUser.email,
                        privacy: privacy,
                        likes: 0,
                        likedBy: [],
                        timestamp: new Date().toISOString(),
                        folder: 'General'
                    };
                    
                    // Guardar archivo en IndexedDB
                    const transaction = db.transaction(['files'], 'readwrite');
                    const store = transaction.objectStore('files');
                    const request = store.add(fileObj);
                    
                    request.onsuccess = function() {
                        displayMessage('register-message', 'Archivo(s) subido(s) con éxito!', 'success');
                        document.getElementById('upload-form').reset();
                        
                        // Actualizar galería si está visible
                        if (document.getElementById('gallery-content').style.display === 'block') {
                            loadGallery();
                        }
                    };
                    
                    request.onerror = function() {
                        displayMessage('register-message', 'Error al subir archivo(s)', 'error');
                    };
                };
                
                // Leer el archivo como Data URL
                if (file.type.startsWith('image/') || file.type.startsWith('video/') || file.type === 'audio/mp3' || file.type === 'application/pdf') {
                    reader.readAsDataURL(file);
                } else {
                    displayMessage('register-message', `Formato de archivo no soportado: ${file.name}`, 'error');
                }
            });
        }
        
        // Determinar tipo de archivo
        function getFileType(file) {
            if (file.type.startsWith('image/')) return 'image';
            if (file.type.startsWith('video/')) return 'video';
            if (file.type === 'audio/mp3') return 'audio';
            if (file.type === 'application/pdf') return 'pdf';
            return 'other';
        }
        
        // Cargar galería de archivos
        function loadGallery() {
            const gallery = document.getElementById('gallery-grid');
            gallery.innerHTML = ''; // Limpiar galería
            
            // Obtener archivos públicos y del usuario actual
            const transaction = db.transaction(['files'], 'readonly');
            const store = transaction.objectStore('files');
            const index = store.index('privacy');
            
            const publicFiles = index.getAll('public');
            const privateFiles = index.getAll('private');
            
            Promise.all([publicFiles, privateFiles]).then(results => {
                const allPublicFiles = results[0];
                const allPrivateFiles = results[1];
                
                // Filtrar archivos privados que pertenezcan al usuario actual
                const userPrivateFiles = allPrivateFiles.filter(file => file.owner === currentUser.email);
                
                // Combinar archivos públicos y privados del usuario
                const filesToShow = [...allPublicFiles, ...userPrivateFiles];
                
                // Ordenar por fecha (más recientes primero)
                filesToShow.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                
                // Mostrar archivos
                if (filesToShow.length === 0) {
                    gallery.innerHTML = '<div class="col-12 text-center py-5"><h5>No hay archivos para mostrar</h5></div>';
                    return;
                }
                
                filesToShow.forEach(file => {
                    const fileCard = createFileCard(file);
                    gallery.appendChild(fileCard);
                });
            });
        }
        
        // Crear tarjeta para archivo en la galería
        function createFileCard(file) {
            const col = document.createElement('div');
            col.className = 'col-md-4 col-lg-3 mb-4';
            
            const card = document.createElement('div');
            card.className = 'card h-100 media-card';
            card.dataset.id = file.id;
            
            // Contenido de la tarjeta según el tipo de archivo
            let cardBody;
            
            if (file.type === 'image') {
                cardBody = `
                    <img src="${file.data}" class="card-img-top" alt="${file.title}" style="height: 200px; object-fit: cover;">
                    ${file.privacy === 'private' ? '<span class="badge bg-secondary private-badge">Privado</span>' : ''}
                `;
            } else if (file.type === 'video') {
                cardBody = `
                    <div class="ratio ratio-16x9">
                        <video src="${file.data}" class="card-img-top" poster="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" style="background-color: #f5f5f5;"></video>
                    </div>
                    ${file.privacy === 'private' ? '<span class="badge bg-secondary private-badge">Privado</span>' : ''}
                `;
            } else if (file.type === 'audio') {
                cardBody = `
                    <div class="card-img-top d-flex justify-content-center align-items-center" style="height: 200px; background-color: #f5f5f5;">
                        <i class="bi bi-file-earmark-music file-icon text-primary"></i>
                    </div>
                `;
            } else if (file.type === 'pdf') {
                cardBody = `
                    <div class="card-img-top d-flex justify-content-center align-items-center" style="height: 200px; background-color: #f5f5f5;">
                        <i class="bi bi-file-earmark-pdf file-icon text-danger"></i>
                    </div>
                `;
            } else {
                cardBody = `
                    <div class="card-img-top d-flex justify-content-center align-items-center" style="height: 200px; background-color: #f5f5f5;">
                        <i class="bi bi-file-earmark file-icon text-secondary"></i>
                    </div>
                `;
            }
            
            // Footer con información del archivo
            let footerHTML = '';
            if (file.owner === currentUser.email) {
                footerHTML = '<small class="text-muted">Subido por ti</small>';
            } else {
                footerHTML = `<small class="text-muted">Subido por ${file.owner.split('@')[0]}</small>`;
            }
            
            card.innerHTML = `
                ${cardBody}
                <div class="card-body">
                    <h6 class="card-title">${file.title}</h6>
                    <p class="card-text text-truncate">${file.description || ''}</p>
                    <div class="d-flex justify-content-between align-items-center">
                        <small class="text-muted">${new Date(file.timestamp).toLocaleDateString()}</small>
                        <div>
                            <span class="me-2"><i class="bi bi-heart${file.likedBy.includes(currentUser.email) ? '-fill liked' : ''}"></i> ${file.likes}</span>
                            <button class="btn btn-sm btn-outline-primary"><i class="bi bi-download"></i></button>
                        </div>
                    </div>
                    ${footerHTML}
                </div>
            `;
            
            // Evento para mostrar detalles del archivo
            card.addEventListener('click', function(e) {
                if (!e.target.classList.contains('bi-download') && !e.target.parentElement.classList.contains('bi-download')) {
                    showFileDetails(file);
                }
            });
            
            col.appendChild(card);
            return col;
        }
        
        // Mostrar detalles del archivo en modal
        function showFileDetails(file) {
            document.getElementById('fileName').textContent = file.title;
            
            // Mostrar vista previa según el tipo de archivo
            const preview = document.getElementById('filePreview');
            preview.innerHTML = '';
            
            if (file.type === 'image') {
                const img = document.createElement('img');
                img.src = file.data;
                img.className = 'img-fluid';
                img.style.maxHeight = '60vh';
                img.alt = file.title;
                preview.appendChild(img);
            } else if (file.type === 'video') {
                const video = document.createElement('video');
                video.src = file.data;
                video.className = 'w-100';
                video.controls = true;
                preview.appendChild(video);
            } else if (file.type === 'audio') {
                const audio = document.createElement('audio');
                audio.src = file.data;
                audio.controls = true;
                audio.className = 'w-100';
                preview.appendChild(audio);
            } // ... (continuación desde el código anterior)

else if (file.type === 'pdf') {
    const embed = document.createElement('embed');
    embed.src = file.data;
    embed.type = 'application/pdf';
    embed.style.width = '100%';
    embed.style.height = '60vh';
    preview.appendChild(embed);
} else {
    const icon = document.createElement('i');
    icon.className = 'bi bi-file-earmark file-icon text-secondary';
    icon.style.fontSize = '5rem';
    preview.appendChild(icon);
}

// Mostrar detalles del archivo
const details = document.getElementById('fileDetails');
details.innerHTML = `
    <p><strong>Descripción:</strong> ${file.description || 'Sin descripción'}</p>
    <p><strong>Tipo:</strong> ${file.type}</p>
    <p><strong>Tamaño:</strong> ${formatFileSize(file.data.length)}</p>
    <p><strong>Subido:</strong> ${new Date(file.timestamp).toLocaleString()}</p>
    <p><strong>Propietario:</strong> ${file.owner === currentUser.email ? 'Tú' : file.owner}</p>
`;

// Configurar botones del modal
const likeBtn = document.getElementById('like-btn');
const likeCount = document.getElementById('like-count');
likeCount.textContent = file.likes;
likeBtn.className = `btn btn-sm btn-outline-secondary like-btn ${file.likedBy.includes(currentUser.email) ? 'liked' : ''}`;
likeBtn.dataset.fileId = file.id;

const downloadBtn = document.getElementById('download-btn');
downloadBtn.dataset.fileId = file.id;

const deleteBtn = document.getElementById('delete-btn');
if (file.owner === currentUser.email || isDeveloper) {
    deleteBtn.style.display = 'inline-block';
    deleteBtn.dataset.fileId = file.id;
} else {
    deleteBtn.style.display = 'none';
}

// Mostrar modal
const modal = new bootstrap.Modal(document.getElementById('fileModal'));
modal.show();
}

// Formatear tamaño de archivo
function formatFileSize(bytes) {
if (bytes < 1024) return bytes + ' bytes';
else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
else return (bytes / 1048576).toFixed(1) + ' MB';
}

// Crear carpeta
function createFolder() {
const folderName = prompt('Ingresa el nombre de la carpeta:');
if (!folderName) return;

const folder = {
    name: folderName,
    owner: currentUser.email,
    created: new Date().toISOString()
};

const transaction = db.transaction(['folders'], 'readwrite');
const store = transaction.objectStore('folders');
const request = store.add(folder);

request.onsuccess = function() {
    alert('Carpeta creada con éxito!');
    loadGallery();
};

request.onerror = function() {
    alert('Error al crear carpeta');
};
}

// Cargar opciones para compartir
function loadShareOptions() {
// Limpiar selects
document.getElementById('share-user').innerHTML = '<option value="">Selecciona un usuario</option>';
document.getElementById('share-file').innerHTML = '<option value="">Selecciona un archivo</option>';

// Cargar usuarios (excluyendo al usuario actual)
const transactionUsers = db.transaction(['users'], 'readonly');
const usersStore = transactionUsers.objectStore('users');
const usersRequest = usersStore.getAll();

usersRequest.onsuccess = function() {
    const users = usersRequest.result.filter(user => user.email !== currentUser.email);
    
    if (users.length === 0) {
        document.getElementById('share-user').innerHTML = '<option value="">No hay otros usuarios</option>';
        return;
    }
    
    users.forEach(user => {
        const option = document.createElement('option');
        option.value = user.email;
        option.textContent = `${user.fullname} (${user.email})`;
        document.getElementById('share-user').appendChild(option);
    });
};

// Cargar archivos del usuario actual
const transactionFiles = db.transaction(['files'], 'readonly');
const filesStore = transactionFiles.objectStore('files');
const index = filesStore.index('owner');
const filesRequest = index.getAll(currentUser.email);

filesRequest.onsuccess = function() {
    const files = filesRequest.result;
    
    if (files.length === 0) {
        document.getElementById('share-file').innerHTML = '<option value="">No tienes archivos para compartir</option>';
        return;
    }
    
    files.forEach(file => {
        const option = document.createElement('option');
        option.value = file.id;
        option.textContent = `${file.title} (${file.type})`;
        document.getElementById('share-file').appendChild(option);
    });
};
}

// Compartir archivo
function shareFile() {
const userId = document.getElementById('share-user').value;
const fileId = parseInt(document.getElementById('share-file').value);

if (!userId || !fileId) {
    alert('Por favor selecciona un usuario y un archivo');
    return;
}

const transaction = db.transaction(['files'], 'readwrite');
const store = transaction.objectStore('files');
const request = store.get(fileId);

request.onsuccess = function() {
    const file = request.result;
    
    if (!file) {
        alert('Archivo no encontrado');
        return;
    }
    
    // Verificar que el archivo pertenezca al usuario actual
    if (file.owner !== currentUser.email) {
        alert('Solo puedes compartir archivos que te pertenezcan');
        return;
    }
    
    // Crear una copia compartida del archivo
    const sharedFile = {
        ...file,
        id: undefined, // Para que se genere un nuevo ID
        sharedWith: userId,
        originalOwner: currentUser.email,
        timestamp: new Date().toISOString()
    };
    
    const addRequest = store.add(sharedFile);
    
    addRequest.onsuccess = function() {
        alert('Archivo compartido con éxito!');
        document.getElementById('share-user').value = '';
        document.getElementById('share-file').value = '';
    };
    
    addRequest.onerror = function() {
        alert('Error al compartir archivo');
    };
};
}

// Cargar tabla de usuarios (solo para admin)
function loadUsersTable() {
if (!isDeveloper) return;

const table = document.getElementById('users-table');
table.innerHTML = '';

const transaction = db.transaction(['users'], 'readonly');
const store = transaction.objectStore('users');
const request = store.getAll();

request.onsuccess = function() {
    const users = request.result;
    
    if (users.length === 0) {
        table.innerHTML = '<tr><td colspan="5" class="text-center">No hay usuarios registrados</td></tr>';
        return;
    }
    
    users.forEach(user => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${user.fullname}</td>
            <td>${user.email}</td>
            <td>${user.phone}</td>
            <td>${user.isDeveloper ? 'Desarrollador' : 'Usuario normal'}</td>
            <td>
                <button class="btn btn-sm btn-danger delete-user-btn" data-email="${user.email}">
                    <i class="bi bi-trash"></i>
                </button>
            </td>
        `;
        table.appendChild(row);
    });
    
    // Configurar eventos para botones de eliminar
    document.querySelectorAll('.delete-user-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const email = this.dataset.email;
            if (confirm(`¿Estás seguro de eliminar al usuario ${email}?`)) {
                deleteUser(email);
            }
        });
    });
};
}

// Eliminar usuario
function deleteUser(email) {
if (email === currentUser.email) {
    alert('No puedes eliminarte a ti mismo');
    return;
}

const transaction = db.transaction(['users'], 'readwrite');
const store = transaction.objectStore('users');
const request = store.delete(email);

request.onsuccess = function() {
    alert('Usuario eliminado con éxito');
    loadUsersTable();
};

request.onerror = function() {
    alert('Error al eliminar usuario');
};
}

// Dar like a un archivo
function toggleLike() {
const fileId = parseInt(this.dataset.fileId);
const transaction = db.transaction(['files'], 'readwrite');
const store = transaction.objectStore('files');
const request = store.get(fileId);

request.onsuccess = function() {
    const file = request.result;
    
    if (!file) return;
    
    const userIndex = file.likedBy.indexOf(currentUser.email);
    
    if (userIndex === -1) {
        // Añadir like
        file.likes++;
        file.likedBy.push(currentUser.email);
    } else {
        // Quitar like
        file.likes--;
        file.likedBy.splice(userIndex, 1);
    }
    
    const updateRequest = store.put(file);
    
    updateRequest.onsuccess = function() {
        // Actualizar contador en el modal
        document.getElementById('like-count').textContent = file.likes;
        
        // Actualizar estado del botón
        const likeBtn = document.getElementById('like-btn');
        likeBtn.classList.toggle('liked');
        
        // Actualizar galería si está visible
        if (document.getElementById('gallery-content').style.display === 'block') {
            loadGallery();
        }
    };
};
}

// Descargar archivo
function downloadFile() {
const fileId = parseInt(this.dataset.fileId);
const transaction = db.transaction(['files'], 'readonly');
const store = transaction.objectStore('files');
const request = store.get(fileId);

request.onsuccess = function() {
    const file = request.result;
    
    if (!file) {
        alert('Archivo no encontrado');
        return;
    }
    
    // Crear enlace de descarga
    const a = document.createElement('a');
    a.href = file.data;
    a.download = file.name;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
};
}

// Eliminar archivo
function deleteFile() {
if (!confirm('¿Estás seguro de eliminar este archivo?')) return;

const fileId = parseInt(this.dataset.fileId);
const transaction = db.transaction(['files'], 'readwrite');
const store = transaction.objectStore('files');
const request = store.delete(fileId);

request.onsuccess = function() {
    // Cerrar modal
    const modal = bootstrap.Modal.getInstance(document.getElementById('fileModal'));
    modal.hide();
    
    // Actualizar galería
    loadGallery();
};

request.onerror = function() {
    alert('Error al eliminar archivo');
};
}

