<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión Universitaria</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #34495e;
        }
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 10px;
            overflow: hidden;
            background-color: white;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--dark-color));
            color: white;
            padding: 15px 0;
            text-align: center;
            position: relative;
        }
        .logo-container {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background-color: white;
            margin: -60px auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
            z-index: 10;
            overflow: hidden;
        }
        .logo-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }
        .logo-placeholder {
            font-size: 3rem;
            color: var(--secondary-color);
        }
        .faculty-name {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .faculty-info {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        .module-container {
            padding: 25px;
            min-height: 500px;
        }
        .module-card {
            border-radius: 10px;
            overflow: hidden;
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
        }
        .module-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .module-header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px;
            font-weight: 600;
        }
        .module-content {
            padding: 20px;
        }
        .nav-tabs .nav-link {
            color: var(--dark-color);
            font-weight: 500;
            border: none;
            border-radius: 0;
        }
        .nav-tabs .nav-link.active {
            background-color: var(--secondary-color);
            color: white;
            border: none;
        }
        .btn-primary {
            background-color: var(--secondary-color);
            border: none;
        }
        .btn-primary:hover {
            background-color: #2980b9;
        }
        .btn-danger {
            background-color: var(--accent-color);
            border: none;
        }
        .action-buttons .btn {
            margin: 2px;
            font-size: 0.8rem;
        }
        .file-card {
            border-left: 4px solid var(--secondary-color);
            transition: all 0.3s;
        }
        .file-card:hover {
            background-color: #f1f9ff;
            transform: translateX(5px);
        }
        .password-strength {
            height: 5px;
            width: 100%;
            background-color: #e0e0e0;
            border-radius: 2px;
            margin-top: 5px;
        }
        .strength-meter {
            height: 100%;
            border-radius: 2px;
            transition: width 0.3s;
        }
        .log-entry {
            border-left: 3px solid var(--secondary-color);
            padding-left: 10px;
            margin-bottom: 10px;
        }
        .log-entry.deletion {
            border-left-color: var(--accent-color);
        }
        .footer {
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            text-align: center;
            font-size: 0.9rem;
        }
        .hidden {
            display: none;
        }
        .password-container {
            position: relative;
        }
        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #777;
        }
        .department-badge {
            font-size: 0.9rem;
            margin: 5px;
        }
        .folder-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
        }
        .folder-card:hover {
            border-color: var(--secondary-color);
            box-shadow: 0 5px 10px rgba(0,0,0,0.05);
        }
        .file-icon {
            font-size: 2rem;
            color: #e74c3c;
        }
        .role-badge {
            font-size: 0.8rem;
            padding: 4px 8px;
            border-radius: 20px;
        }
        .admin-badge {
            background-color: #e74c3c;
            color: white;
        }
        .secretariat-badge {
            background-color: #3498db;
            color: white;
        }
        .department-badge {
            background-color: #2ecc71;
            color: white;
        }
        .user-badge {
            background-color: #f39c12;
            color: white;
        }
        .stat-card {
            border-radius: 10px;
            background: linear-gradient(135deg, #3498db, #2c3e50);
            color: white;
            padding: 15px;
            text-align: center;
            margin-bottom: 20px;
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .stat-label {
            font-size: 1rem;
            opacity: 0.9;
        }
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        .search-icon {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }
        .search-input {
            padding-left: 35px;
        }
        .no-results {
            text-align: center;
            padding: 20px;
            color: #777;
            font-style: italic;
        }
        /* Login/Register modal styles */
        .auth-modal .modal-content {
            border-radius: 15px;
        }
        .auth-modal .form-control {
            border-radius: 8px;
        }
        .auth-modal .modal-header {
            border-bottom: none;
        }
        .auth-modal .modal-footer {
            border-top: none;
        }
        .auth-modal .toggle-link {
            cursor: pointer;
            color: var(--secondary-color);
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="app-container" id="mainApp" style="display: none;">
        <!-- HEADER, NAVBAR, MODULES, FOOTER (igual que antes, sin datos simulados, sin valores por defecto) -->

        <!-- ... (todo el HTML principal igual que tu ejemplo, pero con los valores por defecto retirados) ... -->

        <!-- Encabezado con logo y nombre de facultad -->
        <div class="header">
            <div class="logo-container" id="logo-display">
                <i class="fas fa-university logo-placeholder"></i>
            </div>
            <h1 class="faculty-name" id="faculty-name"></h1>
            <p class="faculty-info"><i class="fas fa-envelope"></i> <span id="faculty-email"></span> | <i class="fas fa-phone"></i> <span id="faculty-phone"></span></p>
            <p class="faculty-info">Año Académico: <span id="academic-year"></span></p>
        </div>
        <!-- ... resto igual ... (NAVEGACIÓN, MODULOS, FOOTER, MODALES) ... -->
        <!-- ... CONTENIDO OMITIDO PARA ENFOCAR EN LA LÓGICA NUEVA ... -->
    </div>

    <!-- MODALES LOGIN Y REGISTRO -->
    <div class="modal fade auth-modal" id="authModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authModalTitle">Iniciar Sesión</h5>
                </div>
                <div class="modal-body">
                    <form id="login-form">
                        <div class="mb-3">
                            <label class="form-label">Usuario</label>
                            <input type="text" class="form-control" id="login-username" required autocomplete="username">
                        </div>
                        <div class="mb-3 password-container">
                            <label class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="login-password" required autocomplete="current-password">
                            <span class="toggle-password" id="toggle-login-password"><i class="fas fa-eye"></i></span>
                        </div>
                        <div class="mb-2 text-end">
                            <span class="toggle-link" id="show-register">¿No tienes cuenta? Regístrate</span>
                        </div>
                        <div id="login-error" class="text-danger mb-2" style="display: none;"></div>
                        <button type="submit" class="btn btn-primary w-100">Ingresar</button>
                    </form>
                    <form id="register-form" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">Nombre de Usuario</label>
                            <input type="text" class="form-control" id="register-username" required autocomplete="username">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Correo</label>
                            <input type="email" class="form-control" id="register-email" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Rol</label>
                            <select class="form-select" id="register-role" required>
                                <option value="">Selecciona un rol</option>
                                <option value="Admin">Administrador</option>
                                <option value="Secretaría">Secretaría General</option>
                                <option value="Departamento">Departamento</option>
                                <option value="Usuario">Usuario</option>
                            </select>
                        </div>
                        <div class="mb-3 password-container">
                            <label class="form-label">Contraseña</label>
                            <input type="password" class="form-control" id="register-password" required autocomplete="new-password">
                            <span class="toggle-password" id="toggle-register-password"><i class="fas fa-eye"></i></span>
                        </div>
                        <div class="mb-2 text-end">
                            <span class="toggle-link" id="show-login">¿Ya tienes cuenta? Inicia sesión</span>
                        </div>
                        <div id="register-error" class="text-danger mb-2" style="display: none;"></div>
                        <button type="submit" class="btn btn-success w-100">Registrarse</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- ... RESTO DE MODALES: addDepartmentModal, addFolderModal, uploadFileModal ... (igual que tu código de ejemplo) -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // --- IndexedDB CONFIG ---
        const DB_NAME = 'university_management';
        const DB_VERSION = 2;
        const STORES = {
            FACULTIES: 'faculties',
            DEPARTMENTS: 'departments',
            FOLDERS: 'folders',
            DOCUMENTS: 'documents',
            ACTIVITIES: 'activities',
            USERS: 'users'
        };
        let db;
        let currentUser = null; // El usuario autenticado
        let currentDepartmentId = null;
        let currentFolderId = null;
        let currentFacultyLogo = null; // Blob o DataURL

        // AUTH: Hash simple (para demo, usar bcrypt en producción)
        function hashPass(p) {
            return Array.from(new TextEncoder().encode(p)).reduce((s,x)=>s+String.fromCharCode(x),'');
        }

        // ----- IndexedDB -----
        function initDB() {
            const req = indexedDB.open(DB_NAME, DB_VERSION);
            req.onupgradeneeded = function(event) {
                db = event.target.result;
                // Crear stores si faltan
                for (const k in STORES) {
                    if (!db.objectStoreNames.contains(STORES[k])) {
                        db.createObjectStore(STORES[k], { keyPath: 'id', autoIncrement: true });
                    }
                }
            };
            req.onsuccess = function(event) {
                db = event.target.result;
                showAuthModal(); // Mostrar login/registro antes que nada
            };
            req.onerror = function(event) {
                alert('Error abriendo base de datos.');
            };
        }
        // CRUD BASICS
        function saveData(storeName, data) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([storeName], 'readwrite');
                const store = tx.objectStore(storeName);
                const req = store.add(data);
                req.onsuccess = e => resolve(e.target.result);
                req.onerror = e => reject(e.target.error);
            });
        }
        function updateData(storeName, id, data) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([storeName], 'readwrite');
                const store = tx.objectStore(storeName);
                const getReq = store.get(id);
                getReq.onsuccess = function(e) {
                    const record = e.target.result;
                    if (record) {
                        const updated = {...record, ...data};
                        const putReq = store.put(updated);
                        putReq.onsuccess = ()=>resolve(updated);
                        putReq.onerror = e=>reject(e.target.error);
                    } else reject(new Error('No encontrado'));
                };
                getReq.onerror = e=>reject(e.target.error);
            });
        }
        function getAllData(storeName) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([storeName], 'readonly');
                const store = tx.objectStore(storeName);
                const req = store.getAll();
                req.onsuccess = e => resolve(e.target.result);
                req.onerror = e => reject(e.target.error);
            });
        }
        function getDataBy(storeName, key, value) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([storeName], 'readonly');
                const store = tx.objectStore(storeName);
                const req = store.getAll();
                req.onsuccess = e => {
                    const res = e.target.result.filter(x=>x[key]===value);
                    resolve(res);
                };
                req.onerror = e => reject(e.target.error);
            });
        }
        function getRecordBy(storeName, key, value) {
            return new Promise((resolve, reject) => {
                const tx = db.transaction([storeName], 'readonly');
                const store = tx.objectStore(storeName);
                const req = store.getAll();
                req.onsuccess = e => {
                    const found = e.target.result.find(x => x[key] === value);
                    resolve(found);
                };
                req.onerror = e => reject(e.target.error);
            });
        }
        // ---- AUTH ----
        function showAuthModal() {
            const authModal = new bootstrap.Modal(document.getElementById('authModal'), { backdrop: 'static', keyboard: false });
            document.getElementById('mainApp').style.display = 'none';
            authModal.show();
        }
        function setUserSession(user) {
            currentUser = user;
            document.getElementById('mainApp').style.display = '';
            document.querySelectorAll('.dropdown-toggle').forEach(btn=>{
                btn.innerHTML = `<i class="fas fa-user-circle me-2"></i>${user.username}`;
            });
            // Actualizar UI para el rol
            // (puedes ocultar módulos o enlaces según currentUser.role aquí)
            // ...
            // Cargar datos principales
            loadFacultyConfig();
            loadDashboardData();
            loadDepartments();
            loadActivities();
        }
        // --- Login/Register handlers ---
        document.addEventListener('DOMContentLoaded', function() {
            // Login/registro toggle
            document.getElementById('show-register').onclick = function() {
                document.getElementById('login-form').style.display = 'none';
                document.getElementById('register-form').style.display = '';
                document.getElementById('authModalTitle').textContent = 'Registro de Usuario';
            };
            document.getElementById('show-login').onclick = function() {
                document.getElementById('login-form').style.display = '';
                document.getElementById('register-form').style.display = 'none';
                document.getElementById('authModalTitle').textContent = 'Iniciar Sesión';
            };
            // Mostrar/ocultar contraseña
            document.getElementById('toggle-login-password').onclick = function() {
                const input = document.getElementById('login-password');
                input.type = input.type === 'password' ? 'text' : 'password';
                this.innerHTML = input.type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            };
            document.getElementById('toggle-register-password').onclick = function() {
                const input = document.getElementById('register-password');
                input.type = input.type === 'password' ? 'text' : 'password';
                this.innerHTML = input.type === 'password' ? '<i class="fas fa-eye"></i>' : '<i class="fas fa-eye-slash"></i>';
            };
            // LOGIN
            document.getElementById('login-form').onsubmit = async function(e) {
                e.preventDefault();
                const username = document.getElementById('login-username').value.trim();
                const password = document.getElementById('login-password').value;
                const user = await getRecordBy(STORES.USERS, 'username', username);
                if (user && user.password === hashPass(password)) {
                    document.getElementById('login-error').style.display = 'none';
                    bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
                    setUserSession(user);
                } else {
                    document.getElementById('login-error').textContent = 'Credenciales incorrectas';
                    document.getElementById('login-error').style.display = '';
                }
            };
            // REGISTRO
            document.getElementById('register-form').onsubmit = async function(e) {
                e.preventDefault();
                const username = document.getElementById('register-username').value.trim();
                const email = document.getElementById('register-email').value.trim();
                const role = document.getElementById('register-role').value;
                const password = document.getElementById('register-password').value;
                if (!username || !email || !role || !password) {
                    document.getElementById('register-error').textContent = 'Completa todos los campos';
                    document.getElementById('register-error').style.display = '';
                    return;
                }
                const exists = await getRecordBy(STORES.USERS, 'username', username);
                if (exists) {
                    document.getElementById('register-error').textContent = 'El usuario ya existe';
                    document.getElementById('register-error').style.display = '';
                    return;
                }
                await saveData(STORES.USERS, {
                    username, email, role, password: hashPass(password)
                });
                document.getElementById('register-error').style.display = 'none';
                alert('Registro exitoso, ahora puedes iniciar sesión.');
                document.getElementById('show-login').click();
            };
        });
        // ----- FACULTY LOGO -----
        function loadFacultyConfig() {
            getAllData(STORES.FACULTIES).then(faculties => {
                if (faculties.length > 0) {
                    const faculty = faculties[0];
                    document.getElementById('faculty-name').textContent = faculty.name || '';
                    document.getElementById('faculty-email').textContent = faculty.email || '';
                    document.getElementById('faculty-phone').textContent = faculty.phone || '';
                    document.getElementById('academic-year').textContent = faculty.academicYear || '';
                    // Logo
                    if (faculty.logo) {
                        setLogoDisplay(faculty.logo);
                    } else {
                        setLogoDisplay(null);
                    }
                } else {
                    // Vacío, no datos simulados
                    setLogoDisplay(null);
                }
            });
        }
        function setLogoDisplay(logoDataUrl) {
            const logoDiv = document.getElementById('logo-display');
            logoDiv.innerHTML = '';
            if (logoDataUrl) {
                const img = document.createElement('img');
                img.src = logoDataUrl;
                img.className = 'logo-img';
                logoDiv.appendChild(img);
            } else {
                logoDiv.innerHTML = '<i class="fas fa-university logo-placeholder"></i>';
            }
        }
        // Logo input en Configuración
        document.addEventListener('DOMContentLoaded', function() {
            // Si tienes el input del logo así: <input type="file" class="form-control" id="faculty-logo-input">
            // Agrégalo en el HTML del modal de configuración.
            // Escucha el cambio y almacena DataURL en IndexedDB.
            if (!document.getElementById('faculty-logo-input') && document.getElementById('configuration-module')) {
                // Si no existe el input, créalo dinámicamente (mejor ponerlo en el HTML)
                const input = document.createElement('input');
                input.type = "file";
                input.accept = "image/png, image/jpeg";
                input.className = "form-control";
                input.id = "faculty-logo-input";
                input.style.marginTop = "10px";
                document.querySelector('#configuration-module .module-content .col-md-6').appendChild(input);
            }
            document.getElementById('faculty-logo-input')?.addEventListener('change', function(evt) {
                const file = this.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = function(e) {
                    currentFacultyLogo = e.target.result;
                    setLogoDisplay(currentFacultyLogo);
                };
                reader.readAsDataURL(file);
            });
            // Guardar Configuración de Facultad
            document.getElementById('save-config')?.addEventListener('click', function() {
                const name = document.getElementById('faculty-name-input').value;
                const email = document.getElementById('faculty-email-input').value;
                const phone = document.getElementById('faculty-phone-input').value;
                const academicYear = document.getElementById('academic-year-select').value;
                getAllData(STORES.FACULTIES).then(faculties => {
                    if (faculties.length > 0) {
                        const faculty = faculties[0];
                        updateData(STORES.FACULTIES, faculty.id, {
                            name, email, phone, academicYear, logo: currentFacultyLogo
                        }).then(loadFacultyConfig);
                    } else {
                        saveData(STORES.FACULTIES, {
                            name, email, phone, academicYear, logo: currentFacultyLogo
                        }).then(loadFacultyConfig);
                    }
                });
            });
        });

        // SUBIDA Y VISUALIZACIÓN DE PDF FUNCIONAL Y SEGURA
        document.addEventListener('DOMContentLoaded', function() {
            // Botón de guardar documento PDF
            document.getElementById('save-document')?.addEventListener('click', async function() {
                const fileInput = document.getElementById('document-file');
                const name = document.getElementById('document-name').value.trim();
                const tags = document.getElementById('document-tags').value.trim();
                if (!fileInput.files.length || !name) {
                    alert('Selecciona un PDF y escribe un nombre.');
                    return;
                }
                const file = fileInput.files[0];
                if (file.type !== 'application/pdf' || file.size > 10*1024*1024) {
                    alert('Solo se permiten archivos PDF hasta 10MB.');
                    return;
                }
                // Leer el PDF como Blob y guardar en IndexedDB
                const reader = new FileReader();
                reader.onload = async function(e) {
                    const documentData = {
                        name,
                        tags: tags.split(',').map(t=>t.trim()).filter(Boolean),
                        file: e.target.result,
                        folderId: currentFolderId,
                        departmentId: currentDepartmentId,
                        uploadedBy: currentUser.username,
                        uploadedAt: new Date().toISOString()
                    };
                    await saveData(STORES.DOCUMENTS, documentData);
                    // Registrar en actividades
                    await saveData(STORES.ACTIVITIES, {
                        date: new Date().toLocaleString(),
                        user: currentUser.username,
                        role: currentUser.role,
                        department: currentDepartmentId,
                        action: 'subió documento',
                        details: name
                    });
                    // Cerrar modal, limpiar, recargar documentos
                    bootstrap.Modal.getInstance(document.getElementById('uploadFileModal')).hide();
                    document.getElementById('document-form').reset();
                    loadDocuments(currentFolderId);
                    alert('Documento subido correctamente.');
                };
                reader.readAsDataURL(file);
            });
        });

        // SECRETARÍA GENERAL: ABRIR DEPARTAMENTOS, CARPETAS Y DOCUMENTOS
        function loadDepartments() {
            getAllData(STORES.DEPARTMENTS).then(departments => {
                const container = document.getElementById('departments-container');
                if (!container) return;
                container.innerHTML = '';
                if (departments.length > 0) {
                    departments.forEach(dept => {
                        const col = document.createElement('div');
                        col.className = 'col-md-4 mb-3';
                        col.innerHTML = `
                            <div class="folder-card" style="cursor:pointer" data-id="${dept.id}">
                                <div class="d-flex justify-content-between">
                                    <h6>${dept.name}</h6>
                                </div>
                                <div>${dept.description || ''}</div>
                            </div>
                        `;
                        container.appendChild(col);
                    });
                    // Click para abrir departamento
                    container.querySelectorAll('.folder-card').forEach(card => {
                        card.onclick = function() {
                            currentDepartmentId = parseInt(this.getAttribute('data-id'));
                            loadFolders(currentDepartmentId);
                            showModule('departments');
                        };
                    });
                } else {
                    container.innerHTML = '<div class="col-12"><div class="no-results">No hay departamentos registrados</div></div>';
                }
            });
        }
        function loadFolders(departmentId) {
            getDataBy(STORES.FOLDERS, 'departmentId', departmentId).then(folders => {
                const container = document.getElementById('folders-container');
                if (!container) return;
                container.innerHTML = '';
                if (folders.length > 0) {
                    folders.forEach(folder => {
                        const col = document.createElement('div');
                        col.className = 'col-md-4 mb-3';
                        col.innerHTML = `
                            <div class="folder-card" style="cursor:pointer" data-id="${folder.id}">
                                <div class="d-flex justify-content-between">
                                    <h6>${folder.name}</h6>
                                </div>
                                <div>${folder.academicYear}</div>
                            </div>
                        `;
                        container.appendChild(col);
                    });
                    // Click para abrir carpeta
                    container.querySelectorAll('.folder-card').forEach(card => {
                        card.onclick = function() {
                            currentFolderId = parseInt(this.getAttribute('data-id'));
                            loadDocuments(currentFolderId);
                        };
                    });
                } else {
                    container.innerHTML = '<div class="col-12"><div class="no-results">No hay carpetas en este departamento</div></div>';
                }
            });
        }
        function loadDocuments(folderId) {
            getDataBy(STORES.DOCUMENTS, 'folderId', folderId).then(documents => {
                const container = document.getElementById('documents-container');
                if (!container) return;
                container.innerHTML = '';
                if (documents.length > 0) {
                    documents.forEach(doc => {
                        const item = document.createElement('div');
                        item.className = 'list-group-item d-flex align-items-center justify-content-between';
                        item.innerHTML = `
                            <span>
                                <i class="fas fa-file-pdf file-icon me-2"></i>
                                <strong>${doc.name}</strong>
                                <small class="text-muted ms-2">${doc.tags.join(', ')}</small>
                            </span>
                            <button class="btn btn-sm btn-outline-info" data-docid="${doc.id}"><i class="fas fa-eye"></i> Abrir</button>
                        `;
                        container.appendChild(item);
                    });
                    // Abrir visor de PDF
                    container.querySelectorAll('button[data-docid]').forEach(btn => {
                        btn.onclick = function() {
                            const docId = parseInt(this.getAttribute('data-docid'));
                            openPDF(docId);
                        };
                    });
                } else {
                    container.innerHTML = '<div class="no-results">No hay documentos en esta carpeta</div>';
                }
            });
        }
        function openPDF(docId) {
            // Recuperar el PDF y abrir en nueva ventana
            getAllData(STORES.DOCUMENTS).then(docs => {
                const doc = docs.find(x => x.id === docId);
                if (doc && doc.file) {
                    const win = window.open();
                    win.document.write(`<iframe src="${doc.file}" type="application/pdf" width="100%" height="100%"></iframe>`);
                }
            });
        }
        // --- Navegación de módulos
        function showModule(module) {
            document.querySelectorAll('.module-container > div').forEach(md => md.classList.add('hidden'));
            document.getElementById(module+'-module').classList.remove('hidden');
        }

        // Iniciar DB al cargar
        document.addEventListener('DOMContentLoaded', initDB);
    </script>
</body>
</html>
